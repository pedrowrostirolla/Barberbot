<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EstoquePro - Gerenciamento de Estoque e Vendas</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> 
</head>
<body>

    <div id="toast-container"></div>

    <header class="top-nav">
        <div class="logo">EstoquePro</div>
        <nav>
            <button class="nav-btn active" onclick="navegar('TelaPrincipal')"><i class="fas fa-home"></i> Início</button>
            <button class="nav-btn" onclick="navegar('TelaNovaVenda')"><i class="fas fa-cash-register"></i> Venda</button>
            <button class="nav-btn" onclick="navegar('TelaVendas')"><i class="fas fa-history"></i> Histórico Vendas</button>
            <button class="nav-btn" onclick="navegar('TelaProdutos')"><i class="fas fa-box"></i> Produtos</button>
            <button class="nav-btn" onclick="navegar('TelaEstoque')"><i class="fas fa-warehouse"></i> Estoque</button>
            <button class="nav-btn" onclick="navegar('TelaFilaChegada')"><i class="fas fa-users"></i> Fila</button>
            <button class="nav-btn" onclick="navegar('TelaConfiguracoes')"><i class="fas fa-cog"></i> Configurações</button>
        </nav>
    </header>

    <div class="content">

        <div id="TelaPrincipal" class="screen active">
            <div class="header">
                <h2><i class="fas fa-home"></i> Painel Principal</h2>
            </div>
            <div id="avisosEstoqueMinimo" class="mb-20"></div>

            <div class="card-filtro">
                <h3>Produtos Disponíveis</h3>
                <input type="text" id="filtroPrincipal" placeholder="Buscar por nome do produto...">
            </div>
            
            <div class="table-container">
                <table id="tabelaPrincipal" class="data-table">
                    <thead>
                        <tr>
                            <th>Descrição</th>
                            <th class="text-right">Preço Original</th>
                            <th class="text-right">Preço Final</th>
                            <th>Estoque</th>
                            <th>Ação</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaPrincipalCorpo">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="TelaProdutos" class="screen">
            <div class="header">
                <h2><i class="fas fa-box"></i> Cadastro de Produtos</h2>
            </div>

            <div class="actions-bar">
                <button onclick="abrirModalProduto()" class="btn-primary"><i class="fas fa-plus"></i> Novo Produto</button>
                <button onclick="abrirModalExclusaoMassa()" class="btn-danger"><i class="fas fa-trash"></i> Excluir Selecionados</button>
            </div>

            <div class="table-container">
                <table id="tabelaProdutos" class="data-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="checkAll" onclick="toggleCheckAll(this)"></th>
                            <th>Descrição</th>
                            <th>Observação</th>
                            <th class="text-right">V. Compra</th>
                            <th class="text-right">Markup</th>
                            <th class="text-right">V. Venda</th>
                            <th class="text-right">Estoque</th>
                            <th>Disponível</th>
                            <th>Desconto</th>
                            <th>Ação</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaProdutosCorpo">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="TelaEstoque" class="screen">
            <div class="header">
                <h2><i class="fas fa-warehouse"></i> Gerenciamento de Estoque</h2>
            </div>

            <div class="card-filtro">
                <h3>Produto Selecionado: <span id="estoqueProdutoSelecionado" class="tag-produto">Nenhum</span></h3>
                <div class="actions-bar-inline">
                    <input type="text" id="filtroEstoque" placeholder="Buscar produto...">
                    <div id="containerFiltroEstoqueMinimo" style="display: none;">
                        <input type="checkbox" id="filtroEstoqueMinimo">
                        <label for="filtroEstoqueMinimo">Abaixo do Mínimo</label>
                    </div>
                </div>
                <div class="actions-bar-inline mt-10">
                    <button id="btnEntrada" onclick="abrirModalMovimentacao('entrada')" class="btn-success" disabled><i class="fas fa-arrow-up"></i> Entrada</button>
                    <button id="btnSaida" onclick="abrirModalMovimentacao('saida')" class="btn-danger" disabled><i class="fas fa-arrow-down"></i> Saída</button>
                </div>
            </div>

            <div class="table-container">
                <table id="tabelaEstoque" class="data-table">
                    <thead>
                        <tr>
                            <th>Produto</th>
                            <th>Observação</th>
                            <th class="text-right">Estoque Atual</th>
                            <th class="text-right">V. Compra</th>
                            <th class="text-right">Valor em Estoque</th>
                            <th>Disponível Venda</th>
                            <th>Selecionar</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaEstoqueCorpo">
                        </tbody>
                </table>
            </div>
        </div>
        
        <div id="TelaNovaVenda" class="screen">
            <div class="header">
                <h2><i class="fas fa-cash-register"></i> Nova Venda</h2>
            </div>

            <div class="split-content">
                <div class="venda-produtos card">
                    <h3>Produtos Selecionados</h3>
                    <div class="table-container-venda">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Produto</th>
                                    <th class="text-right">Valor Final</th>
                                    <th>Qtde</th>
                                    <th class="text-right">Total</th>
                                    <th>Remover</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaNovaVendaCorpo">
                                </tbody>
                        </table>
                    </div>
                </div>

                <div class="venda-resumo card">
                    <h3>Resumo e Pagamento</h3>
                    <div class="form-group">
                        <label for="vendaCliente">Cliente:</label>
                        <input type="text" id="vendaCliente" placeholder="Nome do Cliente">
                    </div>
                    <div class="form-group">
                        <label for="vendaFormaPagamento">Forma de Pagamento: <span class="required">*</span></label>
                        <select id="vendaFormaPagamento" required>
                            <option value="">Selecione...</option>
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="Cartao Credito">Cartão de Crédito</option>
                            <option value="Cartao Debito">Cartão de Débito</option>
                            <option value="Pix">Pix</option>
                        </select>
                    </div>

                    <div class="resumo-detalhes">
                        <p>Subtotal: <span id="vendaSubtotal">R$ 0,00</span></p>
                        <div class="form-group-inline">
                            <input type="checkbox" id="vendaAplicaDesconto" onchange="toggleDescontoVenda()">
                            <label for="vendaAplicaDesconto">Aplicar Desconto Geral (%)</label>
                        </div>
                        <div id="vendaDescontoContainer" style="display: none;">
                            <input type="number" id="vendaDescontoInput" placeholder="%" min="0" max="100" value="0">
                            <p>Desconto: <span id="vendaDescontoValor">R$ 0,00</span></p>
                        </div>
                        <p class="total">Total a Pagar: <span id="vendaTotal">R$ 0,00</span></p>
                    </div>

                    <button id="btnFaturarVenda" onclick="faturarVenda()" class="btn-primary full-width" disabled><i class="fas fa-check-circle"></i> Faturar Venda</button>
                    <button onclick="iniciarNovaVenda()" class="btn-secondary full-width mt-10"><i class="fas fa-sync-alt"></i> Limpar Venda</button>
                </div>
            </div>
        </div>

        <div id="TelaVendas" class="screen">
            <div class="header">
                <h2><i class="fas fa-history"></i> Histórico de Vendas</h2>
            </div>

            <div class="table-container">
                <table id="tabelaVendas" class="data-table">
                    <thead>
                        <tr>
                            <th>Data/Hora</th>
                            <th>Cliente</th>
                            <th>Forma de Pagamento</th>
                            <th class="text-right">Valor Total</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaVendasCorpo">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="TelaFilaChegada" class="screen">
            <div class="header">
                <h2><i class="fas fa-users"></i> Fila de Clientes / Atendimento</h2>
            </div>
            
            <div id="filaContainer" style="display: none;">
                <div class="card-filtro">
                    <div class="fila-resumo">
                        <p>Barbeiros: <span id="filaBarbeiros" class="tag-primary"></span></p>
                        <p>Em Atendimento: <span id="filaAtendimentos" class="tag-info"></span></p>
                        <p>Aguardando: <span id="filaAguardando" class="tag-warning"></span></p>
                        <p>Tempo Médio: <span class="tag-default"></span></p>
                    </div>
                    <div class="actions-bar-inline mt-10">
                        <button onclick="registrarEntradaCliente()" class="btn-success"><i class="fas fa-user-plus"></i> Novo Cliente</button>
                        <button id="btnIniciarAtendimento" onclick="marcarEmAtendimento()" class="btn-primary" disabled><i class="fas fa-handshake"></i> Iniciar Atendimento</button>
                        <button id="btnSaidaAtendimento" onclick="registrarSaidaClienteSelecionado()" class="btn-danger" disabled><i class="fas fa-user-check"></i> Registrar Saída</button>
                    </div>
                </div>

                <div class="table-container">
                    <table id="tabelaFila" class="data-table">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Cliente</th>
                                <th>Hora Chegada</th>
                                <th>Status</th>
                                <th>Tempo Estimado</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaFilaCorpo">
                            </tbody>
                    </table>
                </div>
            </div>
            <div id="filaDesativada" class="alerta-estoque" style="display: none;">
                A Fila de Atendimento está desativada nas <a href="#" onclick="navegar('TelaConfiguracoes')">Configurações</a>.
            </div>
        </div>

        <div id="TelaConfiguracoes" class="screen">
            <div class="header">
                <h2><i class="fas fa-cog"></i> Configurações do Sistema</h2>
            </div>
            
            <div class="settings-grid">
                
                <div class="card settings-card">
                    <h3><i class="fas fa-users"></i> Gerenciamento de Fila</h3>
                    <div class="form-group-inline">
                        <input type="checkbox" id="configControlaFila" onchange="toggleControlaFila(this.checked)">
                        <label for="configControlaFila">Habilitar Controle de Fila</label>
                    </div>

                    <div id="configFilaContainer" style="display: none;">
                        <div class="form-group mt-10">
                            <label for="configQtdBarbeiros">Quantidade de Barbeiros/Atendentes:</label>
                            <input type="number" id="configQtdBarbeiros" min="1" value="1">
                            <button onclick="salvarQtdBarbeiros()" class="btn-secondary-small">Salvar</button>
                        </div>
                        <div class="form-group">
                            <label for="configTempoMedio">Tempo Médio de Atendimento (min):</label>
                            <input type="number" id="configTempoMedio" min="1" value="30">
                            <button onclick="salvarTempoMedioAtendimento()" class="btn-secondary-small">Salvar</button>
                        </div>
                    </div>
                </div>
                
                <div class="card settings-card">
                    <h3><i class="fas fa-warehouse"></i> Controle de Estoque</h3>
                    <div class="form-group-inline">
                        <input type="checkbox" id="configControlaEstoqueMinimo" onchange="toggleControlaEstoqueMinimo(this.checked)">
                        <label for="configControlaEstoqueMinimo">Habilitar Aviso de Estoque Mínimo</label>
                    </div>

                    <div id="configEstoqueMinimoContainer" style="display: none;">
                         <div class="form-group mt-10">
                            <label for="configQtdeMinima">Quantidade Mínima para Alerta:</label>
                            <input type="number" id="configQtdeMinima" min="0" value="5">
                            <button onclick="salvarEstoqueMinimo()" class="btn-secondary-small">Salvar</button>
                        </div>
                    </div>
                </div>

                <div class="card settings-card full-width">
                    <h3><i class="fas fa-database"></i> Backup e Limpeza de Dados</h3>
                    <p class="warning-text">Os dados estão salvos apenas no seu navegador (localStorage).</p>
                    <div class="actions-bar-inline">
                        <button onclick="exportarBackupJson()" class="btn-secondary"><i class="fas fa-download"></i> Exportar Backup (JSON)</button>
                        <button onclick="abrirModalImportacao()" class="btn-secondary"><i class="fas fa-upload"></i> Importar Backup (JSON)</button>
                        <button onclick="limparTodosOsDados()" class="btn-danger"><i class="fas fa-eraser"></i> Limpar TODOS os Dados</button>
                    </div>
                </div>

            </div>
        </div>
    </div>


    <div id="modalProduto" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="fecharModais()">&times;</span>
            <h3 id="modalProdutoTitulo">Novo Produto</h3>
            <form id="formProduto" onsubmit="salvarProduto(event)">
                <input type="hidden" id="prodId">
                <div class="form-group">
                    <label for="prodDescricao">Descrição: <span class="required">*</span></label>
                    <input type="text" id="prodDescricao" required>
                </div>
                <div class="form-group">
                    <label for="prodObs">Observação:</label>
                    <textarea id="prodObs"></textarea>
                </div>

                <div class="form-group-inline">
                    <div>
                        <label for="prodValorCompra">Valor de Compra (R$):</label>
                        <input type="number" id="prodValorCompra" step="0.01" min="0" value="0.00">
                    </div>
                    <div>
                        <label for="prodMarkup">Markup (%):</label>
                        <input type="number" id="prodMarkup" min="0" value="0" oninput="calcularValorVenda()">
                    </div>
                </div>

                <div class="form-group-inline">
                    <div>
                        <label for="prodValorVenda">Valor de Venda (R$): <span class="required">*</span></label>
                        <input type="number" id="prodValorVenda" step="0.01" min="0" required>
                    </div>
                    <div>
                        <label for="prodQtde">Quantidade Inicial/Atual (Estoque):</label>
                        <input type="number" id="prodQtde" min="0" value="0">
                    </div>
                </div>
                
                <div class="form-group-inline">
                    <input type="checkbox" id="prodDisponivel">
                    <label for="prodDisponivel">Disponível para Venda</label>
                </div>

                <button type="submit" class="btn-primary">Salvar Produto</button>
            </form>
        </div>
    </div>

    <div id="modalMovimentacao" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="fecharModais()">&times;</span>
            <h3 id="modalMovimentoTitulo">Movimentação de Estoque</h3>
            <form onsubmit="salvarMovimentacao(event)">
                <input type="hidden" id="movimentoTipo">
                <p>Produto: <strong id="movimentoProdutoNome"></strong></p>
                <p>Estoque Atual: <strong id="movimentoEstoqueAtual"></strong></p>

                <div class="form-group">
                    <label for="movimentoQtd">Quantidade:</label>
                    <input type="number" id="movimentoQtd" min="1" required>
                </div>

                <button type="submit" class="btn-primary">Registrar Movimento</button>
            </form>
        </div>
    </div>

    <div id="modalDesconto" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="fecharModais()">&times;</span>
            <h3>Aplicar Desconto</h3>
            <form onsubmit="aplicarDesconto(event)">
                <input type="hidden" id="descontoProdId">
                <p>Produto: <strong id="descontoNome"></strong></p>

                <div class="form-group-inline">
                    <input type="checkbox" id="descontoAtivo">
                    <label for="descontoAtivo">Desconto Ativo</label>
                </div>

                <div class="form-group">
                    <label for="descontoPercentual">Percentual de Desconto (%):</label>
                    <input type="number" id="descontoPercentual" min="0" max="100" value="0" required>
                </div>

                <button type="submit" class="btn-primary">Salvar Desconto</button>
            </form>
        </div>
    </div>
    
    <div id="modalExclusaoMassa" class="modal">
        <div class="modal-content small-modal">
            <span class="close-btn" onclick="fecharModais()">&times;</span>
            <h3>Confirmação de Exclusão</h3>
            <p>Tem certeza que deseja excluir os <strong id="exclusaoMassaQtde">0</strong> produtos selecionados?</p>
            <div class="actions-bar-inline">
                <button onclick="fecharModais()" class="btn-secondary">Cancelar</button>
                <button onclick="executarExclusaoMassa()" class="btn-danger">Excluir Permanentemente</button>
            </div>
        </div>
    </div>

    <div id="modalDetalhesVenda" class="modal">
        <div class="modal-content large-modal">
            <span class="close-btn" onclick="fecharModais()">&times;</span>
            <h3>Detalhes da Venda</h3>
            <div class="venda-detalhes-grid">
                <p><strong>ID:</strong> <span id="detalhesVendaId"></span></p>
                <p><strong>Data:</strong> <span id="detalhesVendaData"></span></p>
                <p><strong>Cliente:</strong> <span id="detalhesVendaCliente"></span></p>
                <p><strong>Pagamento:</strong> <span id="detalhesVendaPagamento"></span></p>
                <p><strong>Subtotal:</strong> <span id="detalhesVendaSubtotal"></span></p>
                <p><strong>Desconto:</strong> <span id="detalhesVendaDesconto"></span></p>
                <p class="total"><strong>Total:</strong> <span id="detalhesVendaTotal"></span></p>
            </div>
            
            <h4>Itens da Venda</h4>
            <div class="table-container-venda">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Produto</th>
                            <th class="text-right">Valor Unitário</th>
                            <th>Qtde</th>
                            <th class="text-right">Total</th>
                        </tr>
                    </thead>
                    <tbody id="detalhesVendaItensCorpo"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="modalEdicaoVenda" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="fecharModais()">&times;</span>
            <h3>Editar Venda</h3>
            <form onsubmit="salvarEdicaoVenda(event)">
                <input type="hidden" id="edicaoVendaId">
                <p class="total">Total da Venda: <span id="edicaoVendaTotal"></span> (Não Editável)</p>

                <div class="form-group">
                    <label for="edicaoVendaCliente">Cliente:</label>
                    <input type="text" id="edicaoVendaCliente">
                </div>
                <div class="form-group">
                    <label for="edicaoVendaFormaPagamento">Forma de Pagamento:</label>
                    <select id="edicaoVendaFormaPagamento" required>
                        <option value="Dinheiro">Dinheiro</option>
                        <option value="Cartao Credito">Cartão de Crédito</option>
                        <option value="Cartao Debito">Cartão de Débito</option>
                        <option value="Pix">Pix</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">Salvar Alterações</button>
            </form>
        </div>
    </div>

    <div id="modalEdicaoFila" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="fecharModais()">&times;</span>
            <h3>Editar Cliente na Fila</h3>
            <form onsubmit="salvarEdicaoFila(event)">
                <input type="hidden" id="edicaoFilaId">
                <div class="form-group">
                    <label for="edicaoFilaNome">Nome / Identificação:</label>
                    <input type="text" id="edicaoFilaNome" required>
                </div>
                <div class="form-group">
                    <label for="edicaoFilaStatus">Status:</label>
                    <select id="edicaoFilaStatus" required>
                        <option value="Aguardando">Aguardando</option>
                        <option value="Em Atendimento">Em Atendimento</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">Salvar</button>
            </form>
        </div>
    </div>

    <div id="modalImportacao" class="modal">
        <div class="modal-content small-modal">
            <span class="close-btn" onclick="fecharModais()">&times;</span>
            <h3>Importar Dados</h3>
            <p>Selecione o arquivo de backup (JSON) para substituir os dados atuais.</p>
            <input type="file" id="fileInput" accept=".json" onchange="importarDados(event)">
            <p class="warning-text mt-10">Esta ação irá **sobrescrever** todos os dados salvos!</p>
        </div>
    </div>


    <script src="script.js"></script>
</body>
</html>